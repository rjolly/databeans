<project name="databeans" default="jars" basedir=".">

  <target name="compile">
    <mkdir dir="classes"/>
    <javac srcdir="src" destdir="classes"/>
    <rmic base="classes"
          includes="persistence/*Impl.class
                    persistence/util/*.class
                    persistence/beans/Persistent*.class
                    persistence/PersistentArray.class
                    persistence/PersistentSystem.class
                    persistence/Transaction.class"
          excludes="persistence/util/PersistentCollections$*.class
                    persistence/util/PersistentCollections.class
                    persistence/util/Remote*.class"
    />
  </target>

  <target name="compile-debug">
    <mkdir dir="classes"/>
    <javac debug="on" srcdir="src" destdir="classes"/>
    <rmic debug="on"
          base="classes"
          includes="persistence/*Impl.class
                    persistence/util/*.class
                    persistence/beans/Persistent*.class
                    persistence/PersistentArray.class
                    persistence/PersistentSystem.class
                    persistence/Transaction.class"
          excludes="persistence/util/PersistentCollections$*.class
                    persistence/util/PersistentCollections.class
                    persistence/util/Remote*.class"
    />
  </target>

  <target name="jars" depends="jar, client_jar, admin_jar"/>

  <target name="jar" depends="compile">
    <zip destfile="databeans.jar"
         basedir="classes"
         compress="false"
         includes="**/*.class"
    />
  </target>

  <target name="client_jar" depends="compile">
    <zip destfile="databeans_client.jar"
         basedir="classes"
         compress="false"
         includes="persistence/util/Remote*.class
                   persistence/util/PersistentCollections$*.class
                   persistence/util/PersistentCollections.class
                   persistence/beans/Remote*.class
                   persistence/Notified.class
                   persistence/Array.class
                   persistence/RemoteArray.class
                   persistence/PersistentArrays$LocalArray.class
                   persistence/PersistentArrays.class
                   persistence/PersistentException.class
                   persistence/Connections.class
                   persistence/Connection.class
                   persistence/Store.class"
    />
  </target>

  <target name="admin_jar" depends="compile">
    <zip destfile="databeans_admin.jar"
         basedir="classes"
         compress="false"
         includes="persistence/Admin.class
                   persistence/RemoteTransaction.class
                   persistence/RemoteSystem.class
                   persistence/util/Remote*.class
                   persistence/util/PersistentCollections$*.class
                   persistence/util/PersistentCollections.class
                   persistence/beans/Remote*.class
                   persistence/Notified.class
                   persistence/Array.class
                   persistence/RemoteArray.class
                   persistence/PersistentArrays$LocalArray.class
                   persistence/PersistentArrays.class
                   persistence/PersistentException.class
                   persistence/Connections.class
                   persistence/Connection.class
                   persistence/Store.class"
    />
  </target>

  <target name="jars-debug" depends="compile-debug">
    <antcall target="jars"/>
  </target>

  <target name="debug" depends="jars-debug"/>

  <target name="registry">
    <java classname="sun.rmi.registry.RegistryImpl" fork="true"/>
  </target>

  <target name="admin_registry">
    <java classname="sun.rmi.registry.RegistryImpl" fork="true">
      <arg value="2000"/>
    </java>
  </target>

  <target name="run_sample_server" depends="jars">
    <copy file="databeans.jar" todir="sample/server"/>
    <ant dir="sample/server" target="mkheapspace"/>
    <ant dir="sample/server"/>
  </target>

  <target name="run_sample_client" depends="jars">
    <copy file="databeans_client.jar" todir="sample/client"/>
    <ant dir="sample/client"/>
  </target>

  <target name="clean_sample">
    <delete file="sample/server/heapspace" quiet="true"/>
    <delete file="sample/server/databeans.jar" quiet="true"/>
    <delete file="sample/client/databeans_client.jar" quiet="true"/>
    <ant dir="sample/client" target="clean"/>
    <ant dir="sample/server" target="clean"/>
  </target>

  <target name="clean">
    <delete dir="classes" quiet="true"/>
    <delete file="databeans.jar" quiet="true"/>
    <delete file="databeans_admin.jar" quiet="true"/>
    <delete file="databeans_client.jar" quiet="true"/>
  </target>

  <target name="javadoc">
    <delete dir="api" quiet="true"/>
    <mkdir dir="api"/>
    <javadoc sourcepath="src" destdir="api" packagenames="*"/>
  </target>

  <target name="bundle">
    <delete dir="classes" quiet="true"/>
    <zip destfile="../databeans.zip" basedir=".." includes="databeans/**"/>
  </target>

  <target name="chmod">
    <chmod dir="bin"
           perm="+x"
           includes="databeans_admin
                     databeans_export
                     databeans_import
                     mkheapspace"
    />
  </target>

</project>
